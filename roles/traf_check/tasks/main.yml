- name: Check nodes connectivity
  ping: 

- name: Check become method access
  command: "echo"
  become: yes

#- name: Check HBase version

- name: Check hbase-site.xml existence
  stat: path={{ hbase_xml_file }}
  register: hbase_xml
  failed_when: hbase_xml.stat.exists==False

- name: Check JDK version
  shell: "{{ java_home }}/bin/javac -version 2>&1|grep -o '[0-9]\\.[0-9]'"
  register: javac_ver
  failed_when: javac_ver.stdout!='1.7'


- name: Check Hardware Platform should be x86_64
  command: "uname -i"
  register: hw
  failed_when: hw.stdout!='x86_64'

- name: Check if Trafodion is previously installed
  # force rc=0, don't let it fail
  shell: "rpm -qa|grep -c {{ rpm_basename }}; echo -n"
  register: trafinstalled
  become: yes

- name: Check if Trafodion is running
  shell: "source /home/trafodion/.bashrc; sqcheck|grep -c 'The SQ environment is up!'; echo -n"
  register: trafstat
  when: inventory_hostname in groups['firstnode'] and trafinstalled.stdout=='1'
  become_user: trafodion
  become: yes

- name: Stop Trafodion if it's running
  shell: "source /home/trafodion/.bashrc; echo 'y'|ckillall"
  when: inventory_hostname in groups['firstnode'] and trafinstalled.stdout=='1' and trafstat.stdout=='1'
  become_user: trafodion
  become: yes

- set_fact:
    traf_init: "Y"

- set_fact:
    traf_init: "N"
  when: inventory_hostname in groups['firstnode'] and trafinstalled.stdout=='1'
  
